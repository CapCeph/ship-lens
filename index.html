<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ship Lens - Star Citizen Damage Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  </head>
  <body>
    <div id="app">
      <!-- Header -->
      <header class="app-header">
        <div class="logo">
          <span class="logo-icon">◆</span>
          <h1>SHIP LENS</h1>
        </div>
        <div class="header-controls">
          <p class="tagline">COMBAT ANALYSIS SYSTEM</p>
          <button class="fleet-btn" id="fleet-btn" title="My Fleet">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
          </button>
          <button class="about-btn" id="about-btn" title="About">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
          </button>
          <button class="settings-btn" id="settings-btn" title="Settings">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </button>
        </div>
      </header>

      <!-- Settings Modal -->
      <div class="modal-overlay" id="settings-modal">
        <div class="modal modal-wide">
          <div class="modal-header">
            <h3>SETTINGS</h3>
            <button class="modal-close" id="settings-close">&times;</button>
          </div>
          <div class="modal-body">
            <div class="setting-group">
              <label class="setting-label">UI Theme</label>
              <div class="searchable-select theme-select" id="theme-picker-container">
                <input type="text" class="search-input" id="theme-picker-search" placeholder="Select theme..." autocomplete="off" readonly>
                <div class="select-dropdown" id="theme-picker-dropdown">
                  <div class="select-option" data-theme="crusader">Crusader Industries (Default)</div>
                  <div class="select-option" data-theme="drake">Drake Interplanetary</div>
                  <div class="select-option" data-theme="misc">MISC</div>
                  <div class="select-option" data-theme="origin">Origin Jumpworks (Light)</div>
                  <div class="select-option" data-theme="aegis">Aegis Dynamics (Light)</div>
                </div>
                <input type="hidden" id="theme-picker" value="crusader">
              </div>
            </div>
            <p class="settings-note">UI scales automatically based on window size.</p>

            <div class="setting-group setting-group-updates">
              <label class="setting-label">Updates</label>
              <div class="update-check-row">
                <button class="check-updates-btn" id="check-updates-btn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Check for Updates
                </button>
                <span class="update-status" id="update-status"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Save Preset Modal -->
      <div class="modal-overlay" id="save-preset-modal">
        <div class="modal">
          <div class="modal-header">
            <h3>SAVE FLEET PRESET</h3>
            <button class="modal-close" id="save-preset-close">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="preset-name-input">Preset Name</label>
              <input type="text" class="preset-name-input" id="preset-name-input" placeholder="Enter a name (emojis welcome!)" autocomplete="off">
            </div>
            <div class="preset-preview">
              <div class="preview-row">
                <span class="preview-label">Ship</span>
                <span class="preview-value" id="preset-ship-preview">--</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Weapons</span>
                <span class="preview-value" id="preset-weapons-preview">--</span>
              </div>
            </div>
            <button class="save-preset-confirm-btn" id="save-preset-confirm">Save Preset</button>
          </div>
        </div>
      </div>

      <!-- Fleet Management Modal -->
      <div class="modal-overlay" id="fleet-modal">
        <div class="modal modal-wide">
          <div class="modal-header">
            <h3>MY FLEET</h3>
            <button class="modal-close" id="fleet-close">&times;</button>
          </div>
          <div class="modal-body">
            <p class="fleet-description">Your saved ship configurations. Select from the ship dropdown to load a preset.</p>
            <div class="fleet-list" id="fleet-list">
              <p class="placeholder-text">No fleet presets saved yet. Use "Save as Preset" to add your first ship configuration.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Update Available Modal -->
      <div class="modal-overlay" id="update-modal">
        <div class="modal">
          <div class="modal-header">
            <h3>UPDATE AVAILABLE</h3>
            <button class="modal-close" id="update-close">&times;</button>
          </div>
          <div class="modal-body update-modal-body">
            <div class="update-content">
              <div class="update-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
              </div>
              <p class="update-message">A new version of Ship Lens is available!</p>
              <p class="update-version" id="update-version">Version 0.0.0</p>
              <div class="update-actions">
                <button class="update-btn update-btn-primary" id="update-install">Download & Install</button>
                <button class="update-btn update-btn-secondary" id="update-later">Remind Me Later</button>
              </div>
              <p class="update-note" id="update-progress" style="display: none;">Downloading update...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- About Modal -->
      <div class="modal-overlay" id="about-modal">
        <div class="modal modal-wide">
          <div class="modal-header">
            <h3>ABOUT SHIP LENS</h3>
            <button class="modal-close" id="about-close">&times;</button>
          </div>
          <div class="modal-body about-modal-body">
            <div class="about-content">
              <div class="about-app-info">
                <span class="about-version" id="about-version">Ship Lens</span>
                <span class="about-developer">Developed by TheCeph</span>
              </div>
              <img src="/assets/MadeByTheCommunity_White.png" alt="Made By The Community" class="community-logo" onerror="this.nextElementSibling.style.display='block'; this.style.display='none';">
              <span class="community-badge" style="display: none;">MADE BY THE COMMUNITY</span>
              <p class="community-notice">This is an unofficial Star Citizen fan project, not affiliated with the Cloud Imperium group of companies.</p>
              <p class="community-trademark">Star Citizen®, Roberts Space Industries®, and Cloud Imperium® are registered trademarks of Cloud Imperium Rights LLC.</p>
              <a href="https://robertsspaceindustries.com" target="_blank" rel="noopener" class="rsi-link">robertsspaceindustries.com</a>
              <div class="referral-section">
                <p class="referral-text">New to Star Citizen? Use referral code for bonus credits:</p>
                <a href="https://www.robertsspaceindustries.com/enlist?referral=STAR-2DFQ-WXQ6" target="_blank" rel="noopener" class="referral-code">STAR-2DFQ-WXQ6</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Left Panel - Attacker Configuration -->
        <section class="config-panel attacker-panel">
          <div class="panel-header">
            <span class="panel-icon">▶</span>
            <h2>ATTACKER</h2>
          </div>

          <!-- Attacker Ship Section -->
          <div class="panel-section">
            <h3 class="section-title">SHIP SELECTION</h3>
            <div class="form-group">
              <label for="attacker-ship">Ship</label>
              <div class="searchable-select" id="attacker-ship-container">
                <input type="text" class="search-input" id="attacker-ship-search" placeholder="Search ships..." autocomplete="off">
                <div class="select-dropdown" id="attacker-ship-dropdown"></div>
                <input type="hidden" id="attacker-ship" value="">
              </div>
            </div>
            <div class="ship-stats">
              <div class="stat-row">
                <span class="stat-label">Hardpoints</span>
                <span id="attacker-hardpoints" class="stat-value">--</span>
              </div>
            </div>
          </div>

          <!-- Weapon Loadout Section -->
          <div class="panel-section" id="weapon-loadout-section">
            <h3 class="section-title">WEAPON LOADOUT</h3>
            <div id="weapon-slots-container">
              <!-- Weapon slots will be dynamically generated -->
              <p class="placeholder-text">Select a ship to configure weapons</p>
            </div>
            <button class="save-preset-btn" id="save-preset-btn" title="Save current loadout as a fleet preset">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
              Save as Preset
            </button>
          </div>

          <!-- Combat Settings -->
          <div class="panel-section" id="combat-settings-section">
            <h3 class="section-title">COMBAT SETTINGS</h3>
            <div class="form-group">
              <label for="scenario">Scenario</label>
              <div class="searchable-select" id="scenario-container">
                <input type="text" class="search-input" id="scenario-search" placeholder="Select scenario..." autocomplete="off">
                <div class="select-dropdown" id="scenario-dropdown"></div>
                <input type="hidden" id="scenario" value="dogfight">
              </div>
            </div>
            <div class="form-group">
              <label for="mount-type">Mount Type</label>
              <div class="searchable-select" id="mount-type-container">
                <input type="text" class="search-input" id="mount-type-search" placeholder="Select mount..." autocomplete="off">
                <div class="select-dropdown" id="mount-type-dropdown"></div>
                <input type="hidden" id="mount-type" value="Gimballed">
              </div>
            </div>
            <div class="form-group">
              <label for="fire-mode">Fire Mode</label>
              <div class="searchable-select" id="fire-mode-container">
                <input type="text" class="search-input" id="fire-mode-search" placeholder="Select mode..." autocomplete="off">
                <div class="select-dropdown" id="fire-mode-dropdown"></div>
                <input type="hidden" id="fire-mode" value="sustained">
              </div>
            </div>
            <div class="form-group">
              <label for="weapon-power">Weapon Power</label>
              <div class="searchable-select" id="weapon-power-container">
                <input type="text" class="search-input" id="weapon-power-search" placeholder="Select power..." autocomplete="off">
                <div class="select-dropdown" id="weapon-power-dropdown"></div>
                <input type="hidden" id="weapon-power" value="0.33">
              </div>
            </div>
          </div>
        </section>

        <!-- Center Panel - Results -->
        <section class="results-panel">
          <!-- TTK Display -->
          <div class="ttk-display">
            <div class="ttk-row">
              <span class="ttk-label">TIME TO KILL</span>
              <span class="ttk-estimate">±</span>
              <span class="ttk-value" id="ttk-value">--</span>
              <span class="ttk-unit">SEC</span>
            </div>
            <div class="dps-row">
              <span class="dps-label">EFFECTIVE DPS</span>
              <span class="dps-value" id="effective-dps">--</span>
            </div>
          </div>

          <!-- Damage Breakdown (4.5 model) -->
          <div class="panel-section damage-breakdown-section">
            <h3 class="section-title">DAMAGE BREAKDOWN</h3>
            <div id="damage-breakdown" class="damage-breakdown">
              <!-- Populated by JS with Physical/Energy/Distortion/Passthrough -->
            </div>
          </div>

          <!-- Damage Timeline -->
          <div class="panel-section">
            <h3 class="section-title">DAMAGE TIMELINE</h3>
            <div class="timeline">
              <div class="timeline-segment shield" id="timeline-shield">
                <span class="timeline-label">SHIELD</span>
                <span class="timeline-time" id="timeline-shield-time">0s</span>
              </div>
              <div class="timeline-segment armor" id="timeline-armor">
                <span class="timeline-label">ARMOR</span>
                <span class="timeline-time" id="timeline-armor-time">0s</span>
              </div>
              <div class="timeline-segment hull" id="timeline-hull">
                <span class="timeline-label">HULL</span>
                <span class="timeline-time" id="timeline-hull-time">0s</span>
              </div>
            </div>
          </div>

          <!-- Loadout Summary -->
          <div class="panel-section">
            <h3 class="section-title">LOADOUT SUMMARY</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <span class="summary-label">Total Raw DPS</span>
                <span class="summary-value" id="total-raw-dps">--</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Accuracy</span>
                <span class="summary-value" id="accuracy-pct">--</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Damage Types</span>
                <span class="summary-value" id="damage-types">--</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Power Draw</span>
                <span class="summary-value" id="power-draw">--</span>
              </div>
            </div>
          </div>

        </section>

        <!-- Right Panel - Target Configuration -->
        <section class="config-panel target-panel">
          <div class="panel-header">
            <span class="panel-icon">◀</span>
            <h2>TARGET</h2>
          </div>

          <!-- Target Ship Section -->
          <div class="panel-section">
            <h3 class="section-title">SHIP SELECTION</h3>
            <div class="form-group">
              <label for="target-ship">Ship</label>
              <div class="searchable-select" id="target-ship-container">
                <input type="text" class="search-input" id="target-ship-search" placeholder="Search ships..." autocomplete="off">
                <div class="select-dropdown" id="target-ship-dropdown"></div>
                <input type="hidden" id="target-ship" value="">
              </div>
            </div>
            <div class="form-group">
              <label for="target-zone">Target Zone</label>
              <div class="searchable-select" id="target-zone-container">
                <input type="text" class="search-input" id="target-zone-search" placeholder="Select zone..." autocomplete="off">
                <div class="select-dropdown" id="target-zone-dropdown"></div>
                <input type="hidden" id="target-zone" value="center-mass">
              </div>
            </div>
          </div>

          <!-- Target Shield -->
          <div class="panel-section">
            <h3 class="section-title">SHIELD CONFIGURATION</h3>
            <div class="form-group">
              <label for="shield">Equipped Shield</label>
              <div class="searchable-select" id="shield-container">
                <input type="text" class="search-input" id="shield-search" placeholder="Search shields..." autocomplete="off">
                <div class="select-dropdown" id="shield-dropdown"></div>
                <input type="hidden" id="shield" value="">
              </div>
            </div>
          </div>

          <!-- Target Survivability -->
          <div class="panel-section">
            <h3 class="section-title">SURVIVABILITY</h3>
            <div class="stats-grid">
              <div class="stat-card shield-card">
                <div class="stat-icon">◈</div>
                <div class="stat-info">
                  <span class="stat-label">
                    Shield HP
                    <span class="info-icon" id="shield-info-icon">
                      <span class="info-icon-symbol">ⓘ</span>
                      <span class="info-tooltip" id="shield-info-tooltip">Loading...</span>
                    </span>
                  </span>
                  <span class="stat-value" id="shield-hp">0</span>
                </div>
                <div class="stat-bar">
                  <div class="stat-bar-fill" id="shield-bar"></div>
                </div>
              </div>
              <div class="stat-card armor-card">
                <div class="stat-icon">▣</div>
                <div class="stat-info">
                  <span class="stat-label">Armor HP</span>
                  <span class="stat-value" id="armor-hp">0</span>
                </div>
                <div class="stat-bar">
                  <div class="stat-bar-fill" id="armor-bar"></div>
                </div>
              </div>
              <div class="stat-card hull-card">
                <div class="stat-icon">◉</div>
                <div class="stat-info">
                  <span class="stat-label">Hull HP</span>
                  <span class="stat-value" id="hull-hp">0</span>
                </div>
                <div class="stat-bar">
                  <div class="stat-bar-fill" id="hull-bar"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Components -->
          <div class="panel-section">
            <h3 class="section-title">COMPONENTS</h3>
            <div class="components-grid">
              <div class="component-item">
                <span class="component-label">Thrusters</span>
                <span class="component-value" id="thruster-hp">0</span>
              </div>
              <div class="component-item">
                <span class="component-label">Power Plants</span>
                <span class="component-value" id="powerplant-hp">0</span>
              </div>
              <div class="component-item">
                <span class="component-label">Coolers</span>
                <span class="component-value" id="cooler-hp">0</span>
              </div>
              <div class="component-item">
                <span class="component-label">Shield Gens</span>
                <span class="component-value" id="shield-gen-hp">0</span>
              </div>
              <div class="component-item">
                <span class="component-label">Quantum Drive</span>
                <span class="component-value" id="qd-hp">0</span>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer class="app-footer">
        <span id="footer-version">Ship Lens</span>
        <span class="separator">|</span>
        <span id="stats-info">Loading data...</span>
        <span class="separator">|</span>
        <span class="developer-credit">Developed by TheCeph</span>
      </footer>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
